{% extends 'base.html' %}
{% block content %}
<h2>Reports</h2>
<div class="row g-4">
  <div class="col-lg-7">
    <div class="card">
      <div class="card-header">Income vs Expenses (last 6 months)</div>
      <div class="card-body">
        <canvas id="trendChart" height="140"></canvas>
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="card">
      <div class="card-header">Category Breakdown ({{ curr_month }})</div>
      <div class="card-body">
        <canvas id="catChart" height="140"></canvas>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const months = {{ months|tojson }};
  const monthIncome = {{ month_income|tojson }};
  const monthExpense = {{ month_expense|tojson }};
  const categories = {{ categories|tojson }};
  const catTotals = {{ cat_totals|tojson }};

  const trendCtx = document.getElementById('trendChart');
  new Chart(trendCtx, {
    type: 'line',
    data: {
      labels: months,
      datasets: [
        { label: 'Income', data: monthIncome, borderColor: 'rgba(25,135,84,1)', backgroundColor: 'rgba(25,135,84,0.2)' },
        { label: 'Expenses', data: monthExpense, borderColor: 'rgba(220,53,69,1)', backgroundColor: 'rgba(220,53,69,0.2)' }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });

  const catCtx = document.getElementById('catChart');
  new Chart(catCtx, {
    type: 'doughnut',
    data: {
      labels: categories,
      datasets: [{ data: catTotals, backgroundColor: ['#0d6efd','#6610f2','#6f42c1','#d63384','#dc3545','#fd7e14','#ffc107','#198754','#20c997','#0dcaf0'] }]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });
</script>
{% endblock %}
